# SEC_TRANS — 影片逐字稿與知識點擷取工具

將影片自動轉為帶時間軸的繁體中文逐字稿，智慧篩選關鍵知識點，搭配最佳截圖，產出精美的 HTML 報告與結構化 JSON。

## 功能特色

- 🎙️ 使用 Mistral AI (`voxtral-mini-latest`) 進行語音轉文字
- 🌐 自動翻譯為繁體中文並校正專有名詞
- 🧠 AI 智慧篩選關鍵知識點，過濾雜訊
- 📸 多候選幀智慧截圖，自動選取最佳畫面
- 📄 產出結構化 JSON + 精美 HTML 報告

---

## 整體流程

```
Video/影片檔
    │
    ▼
┌──────────────────┐
│  1. 音訊提取      │  moviepy 將影片轉為 .mp3
└──────────────────┘
    │
    ▼
┌──────────────────┐
│  2. 語音轉錄      │  Mistral voxtral-mini-latest
│                  │  產出帶時間軸的逐字稿 segments
└──────────────────┘
    │
    ▼
┌──────────────────┐
│  3. AI 智慧處理   │  Mistral mistral-large-latest
│  • 翻譯為繁體中文  │
│  • 校正專有名詞    │  (如「輪機」→「砂輪機」)
│  • 合併鄰近段落    │
│  • 篩選關鍵知識點  │  (目標 5-15 個)
│  • 為每段產生標題  │
│  • 產出整體摘要    │
└──────────────────┘
    │
    ▼
┌──────────────────┐
│  4. 智慧截圖      │  見下方「截圖選取邏輯」
└──────────────────┘
    │
    ▼
┌──────────────────┐
│  5. 輸出結果      │
│  • JSON 逐字稿    │  output/*_transcription.json
│  • HTML 報告      │  output/*_report_v2.html
│  • 截圖資料夾     │  output/screenshots/
└──────────────────┘
```

---

## 截圖選取邏輯

傳統做法是在每個段落取「中間點」來截圖，但這容易抓到轉場畫面或不相關內容。本工具採用 **多候選幀智慧選取** 策略：

### 步驟

1. **候選幀取樣**：在每個知識點的時間範圍內，均勻取 2~5 個候選時間點（取樣數量依段落長度而定，每 3 秒取一幀）。

2. **視覺評分**：對每個候選幀計算「**像素標準差 (Pixel Std Dev)**」作為評分依據：
   - **高分** → 畫面細節豐富（有物件、文字、操作畫面）
   - **低分** → 畫面單調（純色背景、轉場黑畫面、模糊畫面）

3. **選取最佳幀**：取評分最高的候選幀作為該知識點的代表截圖。

### 範例

```
知識點：「正確拆卸與安裝砂輪片」(60s - 90s)

候選幀：
  66s → score: 72.1   (手持零件特寫)
  72s → score: 84.6   (拆卸步驟全景) ← 選中！
  78s → score: 65.3   (轉場畫面)
  84s → score: 70.8   (字卡)

→ 選取 72s 的幀 (score 最高)
```

---

## 安裝與使用

### 前置需求
- Python 3.13+
- [uv](https://docs.astral.sh/uv/) 套件管理工具

### 安裝
```bash
uv sync
```

### 設定
在專案根目錄建立 `.env` 檔案：
```
MISTRAL_API_KEY=your_api_key_here
```

### 執行
1. 將影片檔放入 `Video/` 資料夾
2. 執行：
```bash
uv run python transcribe_video.py
```
3. 查看 `output/` 資料夾中的結果

---

## 輸出結構

```
output/
├── {影片名稱}_transcription.json   # 結構化 JSON
├── {影片名稱}_report_v2.html       # HTML 報告
└── screenshots/
    └── {影片名稱}/
        ├── key_000.jpg
        ├── key_001.jpg
        └── ...
```

### JSON 格式
```json
{
  "summary": "整體內容摘要...",
  "key_moments": [
    {
      "title": "段落標題",
      "start": 0.0,
      "end": 10.5,
      "text": "繁體中文逐字稿內容"
    }
  ]
}
```

---

## 技術棧

| 項目 | 技術 |
|------|------|
| 環境管理 | uv |
| 語音轉錄 | Mistral AI - voxtral-mini-latest |
| 文本處理 | Mistral AI - mistral-large-latest |
| 音訊提取 | moviepy |
| 截圖分析 | numpy (像素標準差) |

---

## 注意事項

- `.env` 檔案已被 `.gitignore` 排除，不會上傳至 GitHub
- `output/` 與 `temp_audio/` 同樣被排除
- 支援的影片格式：`.mp4`, `.mkv`, `.mov`, `.avi`
